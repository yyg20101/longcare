# é•¿æŠ¤é™©é¡¹ç›®æŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: é•¿æŠ¤é™© (Long Care)  
**åŒ…å**: `com.ytone.longcare`  
**å½“å‰ç‰ˆæœ¬**: v1.0 (Build 13)  
**ç¼–è¯‘æ—¥æœŸ**: 2025å¹´11æœˆ29æ—¥  
**æœ€ä½SDKç‰ˆæœ¬**: 24 (Android 7.0)  
**ç›®æ ‡SDKç‰ˆæœ¬**: 34 (Android 14)  
**ç¼–è¯‘SDKç‰ˆæœ¬**: 36  

### é¡¹ç›®ç®€ä»‹

é•¿æŠ¤é™©æ˜¯ä¸€æ¬¾ä¸“ä¸ºæŠ¤ç†äººå‘˜è®¾è®¡çš„Androidç§»åŠ¨åº”ç”¨ï¼Œç”¨äºç®¡ç†å’Œè®°å½•é•¿æœŸæŠ¤ç†ä¿é™©æœåŠ¡ã€‚åº”ç”¨æä¾›äº†å®Œæ•´çš„æŠ¤ç†æœåŠ¡æµç¨‹ç®¡ç†ï¼ŒåŒ…æ‹¬ç”¨æˆ·èº«ä»½è®¤è¯ã€æœåŠ¡è®¢å•ç®¡ç†ã€ä½ç½®è¿½è¸ªã€äººè„¸è¯†åˆ«éªŒè¯ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ¶æ„æ¨¡å¼

é¡¹ç›®é‡‡ç”¨ **Clean Architecture + MVVM** æ¶æ„æ¨¡å¼ï¼Œå…·æœ‰æ¸…æ™°çš„å±‚æ¬¡åˆ’åˆ†ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Presentation Layer              â”‚
â”‚   (UI Components - Jetpack Compose)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          ViewModel Layer                â”‚
â”‚    (State Management - StateFlow)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          Domain Layer                   â”‚
â”‚   (Business Logic - Use Cases)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Data Layer                    â”‚
â”‚  (Repository Pattern - Room + Retrofit) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Data Sources                    â”‚
â”‚    (Remote API + Local Database)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

#### 1. UIå±‚æŠ€æœ¯
- **Jetpack Compose**: 2025.11.01 BOM - å£°æ˜å¼UIæ¡†æ¶
- **Material Design 3**: æœ€æ–°Materialè®¾è®¡è§„èŒƒ
- **Compose Navigation**: ç±»å‹å®‰å…¨çš„å¯¼èˆªç³»ç»Ÿ
- **Coil 3.x**: ç°ä»£åŒ–å›¾ç‰‡åŠ è½½åº“ï¼ˆæ”¯æŒSVGã€GIFã€è§†é¢‘ï¼‰
- **ConstraintLayout Compose**: å¤æ‚å¸ƒå±€æ”¯æŒ

#### 2. æ¶æ„ç»„ä»¶
- **ViewModel**: ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥çš„UIçŠ¶æ€ç®¡ç†
- **StateFlow/SharedFlow**: å“åº”å¼çŠ¶æ€æµ
- **Lifecycle**: 2.10.0 - ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **Navigation Compose**: 2.9.6 - å¯¼èˆªç»„ä»¶
- **Hilt**: 2.57.2 - ä¾èµ–æ³¨å…¥æ¡†æ¶

#### 3. æ•°æ®æŒä¹…åŒ–
- **Room**: 2.8.4 - SQLiteæ•°æ®åº“æŠ½è±¡å±‚
- **DataStore**: 1.2.0 - ç±»å‹å®‰å…¨çš„æ•°æ®å­˜å‚¨
- **Protocol Buffers**: ç±»å‹åŒ–æ•°æ®åºåˆ—åŒ–

#### 4. ç½‘ç»œå±‚
- **Retrofit**: 3.0.0 - RESTful APIå®¢æˆ·ç«¯
- **OkHttp**: 5.3.2 - HTTPå®¢æˆ·ç«¯
- **Kotlinx Serialization**: JSONåºåˆ—åŒ–
- **Moshi**: å¤‡ç”¨JSONè§£æå™¨
- **Wire**: 5.4.0 - Protocol Buffersæ”¯æŒ

#### 5. å¼‚æ­¥ç¼–ç¨‹
- **Kotlin Coroutines**: åç¨‹æ”¯æŒ
- **Flow**: å“åº”å¼æ•°æ®æµ
- **Dispatchers**: IO/Main/Defaultè°ƒåº¦å™¨

#### 6. ä¾èµ–æ³¨å…¥
- **Dagger Hilt**: ç¼–è¯‘æ—¶ä¾èµ–æ³¨å…¥
- **Hilt ViewModel**: ViewModelæ³¨å…¥
- **Hilt Worker**: WorkManageré›†æˆ

#### 7. åå°ä»»åŠ¡
- **WorkManager**: 2.11.0 - å¯é çš„åå°ä»»åŠ¡è°ƒåº¦
- **Foreground Service**: å‰å°æœåŠ¡æ”¯æŒ

#### 8. ç›¸æœºä¸äººè„¸è¯†åˆ«
- **CameraX**: 1.5.1 - ç°ä»£åŒ–ç›¸æœºAPI
- **ML Kit Face Detection**: 16.1.7 - Googleäººè„¸æ£€æµ‹
- **è…¾è®¯äº‘äººè„¸è¯†åˆ«SDK**: v6.6.2 - æ´»ä½“æ£€æµ‹

#### 9. å®šä½æœåŠ¡
- **é«˜å¾·åœ°å›¾å®šä½SDK**: 6.5.1 - ç²¾å‡†å®šä½æœåŠ¡

#### 10. äº‘å­˜å‚¨
- **è…¾è®¯äº‘COS**: 5.9.47 - å¯¹è±¡å­˜å‚¨æœåŠ¡

#### 11. ç³»ç»ŸåŠŸèƒ½
- **NFC**: NFCæ ‡ç­¾è¯»å†™
- **AlarmManager**: ç²¾ç¡®é—¹é’Ÿ
- **NotificationManager**: é€šçŸ¥ç®¡ç†

#### 12. æ„å»ºå·¥å…·
- **Gradle**: 8.13.1 (AGP)
- **Kotlin**: 2.2.21
- **KSP**: 2.3.2 - Kotlinç¬¦å·å¤„ç†
- **Baseline Profile**: æ€§èƒ½ä¼˜åŒ–

## ğŸ“¦ é¡¹ç›®ç»“æ„

### é¡¶å±‚ç›®å½•ç»“æ„

```
longcare/
â”œâ”€â”€ app/                          # ä¸»åº”ç”¨æ¨¡å—
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”‚   â”œâ”€â”€ kotlin/          # Kotlinæºä»£ç 
â”‚   â”‚   â”‚   â”œâ”€â”€ proto/           # Protocol Bufferså®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ res/             # èµ„æºæ–‡ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ AndroidManifest.xml
â”‚   â”‚   â”œâ”€â”€ debug/               # Debugæ„å»ºå˜ä½“
â”‚   â”‚   â”œâ”€â”€ release/             # Releaseæ„å»ºå˜ä½“
â”‚   â”‚   â””â”€â”€ test/                # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ libs/                    # æœ¬åœ°AARåº“
â”‚   â”‚   â”œâ”€â”€ WbCloudFaceLiveSdk-face-v6.6.2-8e4718fc.aar
â”‚   â”‚   â””â”€â”€ WbCloudNormal-v5.1.10-4e3e198.aar
â”‚   â””â”€â”€ build.gradle.kts         # åº”ç”¨çº§æ„å»ºé…ç½®
â”œâ”€â”€ baselineprofile/             # Baseline Profileæ¨¡å—
â”œâ”€â”€ gradle/                      # Gradleé…ç½®
â”‚   â”œâ”€â”€ libs.versions.toml       # ç‰ˆæœ¬ç›®å½•
â”‚   â””â”€â”€ wrapper/
â”œâ”€â”€ build.gradle.kts             # é¡¹ç›®çº§æ„å»ºé…ç½®
â”œâ”€â”€ constants.gradle.kts         # å¸¸é‡å®šä¹‰
â”œâ”€â”€ settings.gradle.kts          # é¡¹ç›®è®¾ç½®
â””â”€â”€ keystore.jks                 # ç­¾åå¯†é’¥åº“
```

### æºç æ¨¡å—ç»“æ„

```
com.ytone.longcare/
â”œâ”€â”€ api/                         # APIæ¥å£å®šä¹‰å±‚
â”‚   â”œâ”€â”€ LongCareApiService.kt   # ä¸»APIæœåŠ¡æ¥å£
â”‚   â”œâ”€â”€ TencentFaceApiService.kt # è…¾è®¯äººè„¸APIæ¥å£
â”‚   â”œâ”€â”€ request/                 # è¯·æ±‚æ¨¡å‹ï¼ˆ26ä¸ªæ–‡ä»¶ï¼‰
â”‚   â””â”€â”€ response/                # å“åº”æ¨¡å‹
â”‚
â”œâ”€â”€ app/                         # åº”ç”¨ç¨‹åºç±»
â”‚   â””â”€â”€ MainApplication.kt       # Applicationå…¥å£
â”‚
â”œâ”€â”€ common/                      # é€šç”¨å·¥å…·å±‚
â”‚   â”œâ”€â”€ event/                   # äº‹ä»¶æ€»çº¿
â”‚   â”‚   â””â”€â”€ AppEventBus.kt
â”‚   â”œâ”€â”€ network/                 # ç½‘ç»œå·¥å…·
â”‚   â”‚   â”œâ”€â”€ ApiResult.kt        # APIç»“æœå°è£…
â”‚   â”‚   â”œâ”€â”€ SafeApiCall.kt      # å®‰å…¨APIè°ƒç”¨
â”‚   â”‚   â””â”€â”€ SafeTencentApiCall.kt
â”‚   â”œâ”€â”€ provider/                # å†…å®¹æä¾›è€…
â”‚   â”‚   â””â”€â”€ CustomFileProvider.kt
â”‚   â””â”€â”€ utils/                   # å·¥å…·ç±»é›†åˆ
â”‚       â”œâ”€â”€ ContextExtensions.kt
â”‚       â”œâ”€â”€ DeviceUtils.kt
â”‚       â”œâ”€â”€ NavigationHelper.kt
â”‚       â”œâ”€â”€ NfcManager.kt
â”‚       â”œâ”€â”€ TimeUtils.kt
â”‚       â”œâ”€â”€ ToastHelper.kt
â”‚       â””â”€â”€ ... (20+å·¥å…·ç±»)
â”‚
â”œâ”€â”€ data/                        # æ•°æ®å±‚å®ç°
â”‚   â”œâ”€â”€ cos/                     # è…¾è®¯äº‘COSå®ç°
â”‚   â”‚   â”œâ”€â”€ model/              # COSæ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ repository/         # COSä»“åº“å®ç°
â”‚   â”œâ”€â”€ repository/              # Repositoryå®ç°ç±»
â”‚   â”‚   â”œâ”€â”€ DefaultUserSessionRepository.kt
â”‚   â”‚   â”œâ”€â”€ LoginRepositoryImpl.kt
â”‚   â”‚   â”œâ”€â”€ OrderRepositoryImpl.kt
â”‚   â”‚   â””â”€â”€ ... (10+ä»“åº“å®ç°)
â”‚   â””â”€â”€ storage/                 # æœ¬åœ°å­˜å‚¨
â”‚       â”œâ”€â”€ AppDataStore.kt
â”‚       â”œâ”€â”€ DataStoreKeys.kt
â”‚       â””â”€â”€ UserSpecificDataStoreManager.kt
â”‚
â”œâ”€â”€ di/                          # ä¾èµ–æ³¨å…¥é…ç½®
â”‚   â”œâ”€â”€ AppModule.kt            # åº”ç”¨çº§æ¨¡å—
â”‚   â”œâ”€â”€ CosModule.kt            # COSæ¨¡å—
â”‚   â”œâ”€â”€ DataStoreModule.kt      # DataStoreæ¨¡å—
â”‚   â”œâ”€â”€ DispatcherModule.kt     # åç¨‹è°ƒåº¦å™¨æ¨¡å—
â”‚   â”œâ”€â”€ EntryPoints.kt          # Hiltå…¥å£ç‚¹
â”‚   â”œâ”€â”€ ImageLoadingModule.kt   # å›¾ç‰‡åŠ è½½æ¨¡å—
â”‚   â”œâ”€â”€ LocationModule.kt       # å®šä½æ¨¡å—
â”‚   â”œâ”€â”€ NetworkModule.kt        # ç½‘ç»œæ¨¡å—
â”‚   â”œâ”€â”€ Qualifiers.kt           # é™å®šç¬¦æ³¨è§£
â”‚   â”œâ”€â”€ RepositoryModule.kt     # ä»“åº“æ¨¡å—
â”‚   â””â”€â”€ ServiceModule.kt        # æœåŠ¡æ¨¡å—
â”‚
â”œâ”€â”€ domain/                      # é¢†åŸŸå±‚
â”‚   â”œâ”€â”€ cos/                     # COSé¢†åŸŸ
â”‚   â”‚   â””â”€â”€ repository/
â”‚   â”œâ”€â”€ faceauth/                # äººè„¸è®¤è¯é¢†åŸŸ
â”‚   â”‚   â””â”€â”€ TencentFaceRepository.kt
â”‚   â”œâ”€â”€ identification/          # èº«ä»½è®¤è¯é¢†åŸŸ
â”‚   â”‚   â””â”€â”€ IdentificationRepository.kt
â”‚   â”œâ”€â”€ location/                # å®šä½é¢†åŸŸ
â”‚   â”‚   â””â”€â”€ LocationRepository.kt
â”‚   â”œâ”€â”€ login/                   # ç™»å½•é¢†åŸŸ
â”‚   â”‚   â””â”€â”€ LoginRepository.kt
â”‚   â”œâ”€â”€ order/                   # è®¢å•é¢†åŸŸ
â”‚   â”‚   â”œâ”€â”€ OrderRepository.kt
â”‚   â”‚   â””â”€â”€ SharedOrderRepository.kt
â”‚   â”œâ”€â”€ profile/                 # ä¸ªäººèµ„æ–™é¢†åŸŸ
â”‚   â”‚   â””â”€â”€ ProfileRepository.kt
â”‚   â”œâ”€â”€ repository/              # é€šç”¨ä»“åº“
â”‚   â”‚   â””â”€â”€ UserSessionRepository.kt
â”‚   â”œâ”€â”€ system/                  # ç³»ç»Ÿé¢†åŸŸ
â”‚   â”‚   â””â”€â”€ SystemRepository.kt
â”‚   â””â”€â”€ userlist/                # ç”¨æˆ·åˆ—è¡¨é¢†åŸŸ
â”‚       â””â”€â”€ UserListRepository.kt
â”‚
â”œâ”€â”€ features/                    # åŠŸèƒ½æ¨¡å—å±‚ï¼ˆ29ä¸ªå­æ¨¡å—ï¼‰
â”‚   â”œâ”€â”€ countdown/              # å€’è®¡æ—¶åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ manager/            # ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ receiver/           # å¹¿æ’­æ¥æ”¶å™¨
â”‚   â”‚   â”œâ”€â”€ service/            # æœåŠ¡
â”‚   â”‚   â””â”€â”€ ui/                 # UIç»„ä»¶
â”‚   â”œâ”€â”€ face/                   # äººè„¸åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ detector/           # äººè„¸æ£€æµ‹å™¨
â”‚   â”‚   â”œâ”€â”€ ui/                 # UIç»„ä»¶
â”‚   â”‚   â””â”€â”€ viewmodel/          # ViewModel
â”‚   â”œâ”€â”€ facecapture/            # äººè„¸æ•è·
â”‚   â”œâ”€â”€ home/                   # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â””â”€â”€ vm/
â”‚   â”œâ”€â”€ identification/         # èº«ä»½è®¤è¯
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â””â”€â”€ vm/
â”‚   â”œâ”€â”€ location/               # ä½ç½®æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ provider/           # å®šä½æä¾›è€…
â”‚   â”‚   â”œâ”€â”€ service/            # å®šä½æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â””â”€â”€ vm/
â”‚   â”œâ”€â”€ login/                  # ç™»å½•åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â””â”€â”€ vm/
â”‚   â”œâ”€â”€ maindashboard/          # ä¸»é¢æ¿
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ vm/
â”‚   â”œâ”€â”€ nfc/                    # NFCåŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â””â”€â”€ vm/
â”‚   â”œâ”€â”€ nursing/                # æŠ¤ç†åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â””â”€â”€ vm/
â”‚   â”œâ”€â”€ nursingexecution/       # æŠ¤ç†æ‰§è¡Œ
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â””â”€â”€ vm/
â”‚   â”œâ”€â”€ photoupload/            # ç…§ç‰‡ä¸Šä¼ 
â”‚   â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â””â”€â”€ vm/
â”‚   â”œâ”€â”€ profile/                # ä¸ªäººèµ„æ–™
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â””â”€â”€ vm/
â”‚   â”œâ”€â”€ service/                # æœåŠ¡åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ di/
â”‚   â”‚   â”œâ”€â”€ receiver/
â”‚   â”‚   â””â”€â”€ storage/
â”‚   â”œâ”€â”€ servicecomplete/        # æœåŠ¡å®Œæˆ
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â””â”€â”€ vm/
â”‚   â”œâ”€â”€ servicecountdown/       # æœåŠ¡å€’è®¡æ—¶
â”‚   â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â””â”€â”€ vm/
â”‚   â”œâ”€â”€ servicehours/           # æœåŠ¡å·¥æ—¶
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â””â”€â”€ vm/
â”‚   â”œâ”€â”€ serviceorders/          # æœåŠ¡è®¢å•
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â””â”€â”€ vm/
â”‚   â”œâ”€â”€ userlist/               # ç”¨æˆ·åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â””â”€â”€ vm/
â”‚   â”œâ”€â”€ userservicerecord/      # ç”¨æˆ·æœåŠ¡è®°å½•
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â””â”€â”€ vm/
â”‚   â””â”€â”€ webview/                # WebView
â”‚       â””â”€â”€ ui/
â”‚
â”œâ”€â”€ MainActivity.kt              # ä¸»Activity
â”œâ”€â”€ MainViewModel.kt             # ä¸»ViewModel
â”‚
â”œâ”€â”€ model/                       # æ•°æ®æ¨¡å‹å±‚
â”‚   â””â”€â”€ ... (ä¸šåŠ¡æ¨¡å‹ç±»)
â”‚
â”œâ”€â”€ navigation/                  # å¯¼èˆªé…ç½®
â”‚   â”œâ”€â”€ AppNavigation.kt        # å¯¼èˆªå›¾
â”‚   â”œâ”€â”€ NavTypes.kt             # è‡ªå®šä¹‰å¯¼èˆªç±»å‹
â”‚   â””â”€â”€ Routes.kt               # è·¯ç”±å®šä¹‰
â”‚
â”œâ”€â”€ network/                     # ç½‘ç»œå±‚
â”‚   â””â”€â”€ interceptor/            # æ‹¦æˆªå™¨
â”‚       â””â”€â”€ MockInterceptor.kt
â”‚
â”œâ”€â”€ presentation/                # å±•ç¤ºå±‚
â”‚   â””â”€â”€ countdown/
â”‚       â””â”€â”€ CountdownAlarmActivity.kt
â”‚
â”œâ”€â”€ shared/                      # å…±äº«ç»„ä»¶
â”‚   â””â”€â”€ vm/                     # å…±äº«ViewModel
â”‚       â”œâ”€â”€ SharedOrderDetailViewModel.kt
â”‚       â”œâ”€â”€ HomeSharedViewModel.kt
â”‚       â””â”€â”€ TodayOrderViewModel.kt
â”‚
â”œâ”€â”€ theme/                       # ä¸»é¢˜é…ç½®
â”‚   â”œâ”€â”€ Color.kt
â”‚   â”œâ”€â”€ Theme.kt
â”‚   â””â”€â”€ Type.kt
â”‚
â”œâ”€â”€ ui/                          # UIç»„ä»¶åº“
â”‚   â””â”€â”€ ... (å¯å¤ç”¨UIç»„ä»¶)
â”‚
â””â”€â”€ worker/                      # åå°ä»»åŠ¡
    â”œâ”€â”€ DownloadWorker.kt
    â””â”€â”€ UpdateWorker.kt
```

## ğŸ”§ ä¾èµ–æ³¨å…¥æ¶æ„

### Hiltæ¨¡å—ä½“ç³»

é¡¹ç›®ä½¿ç”¨Dagger Hiltä½œä¸ºä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œæ¨¡å—åŒ–è®¾è®¡æ¸…æ™°ï¼š

#### 1. AppModule - åº”ç”¨çº§ä¾èµ–
```kotlin
@Module
@InstallIn(SingletonComponent::class)
object AppModule {
    // æä¾›åº”ç”¨çº§å•ä¾‹
    - AlarmManager
    - NotificationManager
    - LocationManager
    - WorkManager
    - AppEventBus
    - ToastHelper
    - NfcManager
    - NfcTestHelper
}
```

#### 2. NetworkModule - ç½‘ç»œä¾èµ–
```kotlin
@Module
@InstallIn(SingletonComponent::class)
object NetworkModule {
    // ç½‘ç»œç»„ä»¶
    - OkHttpClient (å¸¦æ‹¦æˆªå™¨)
    - Retrofit (ä¸»API)
    - Retrofit (è…¾è®¯äººè„¸API)
    - LongCareApiService
    - TencentFaceApiService
}
```

#### 3. RepositoryModule - ä»“åº“ä¾èµ–
```kotlin
@Module
@InstallIn(SingletonComponent::class)
abstract class RepositoryModule {
    // ä»“åº“ç»‘å®š
    @Binds UserSessionRepository
    @Binds LoginRepository
    @Binds OrderRepository
    @Binds ProfileRepository
    @Binds LocationRepository
    @Binds IdentificationRepository
    @Binds SystemRepository
    @Binds TencentFaceRepository
    @Binds UserListRepository
}
```

#### 4. DataStoreModule - æ•°æ®å­˜å‚¨ä¾èµ–
```kotlin
@Module
@InstallIn(SingletonComponent::class)
object DataStoreModule {
    // æ•°æ®å­˜å‚¨
    @AppDataStore DataStore<Preferences>
    @OrderStorage SharedPreferences
    @DeviceIdStorage SharedPreferences
}
```

#### 5. DispatcherModule - åç¨‹è°ƒåº¦å™¨ä¾èµ–
```kotlin
@Module
@InstallIn(SingletonComponent::class)
object DispatcherModule {
    @IoDispatcher CoroutineDispatcher
    @MainDispatcher CoroutineDispatcher
    @DefaultDispatcher CoroutineDispatcher
    @ApplicationScope CoroutineScope
}
```

#### 6. LocationModule - å®šä½æœåŠ¡ä¾èµ–
```kotlin
@Module
@InstallIn(SingletonComponent::class)
object LocationModule {
    - SystemLocationProvider
    - AmapLocationProvider
    - CompositeLocationProvider
    - MainThreadExecutor
}
```

#### 7. CosModule - å¯¹è±¡å­˜å‚¨ä¾èµ–
```kotlin
@Module
@InstallIn(SingletonComponent::class)
abstract class CosModule {
    @Binds CosRepository
}
```

#### 8. ImageLoadingModule - å›¾ç‰‡åŠ è½½ä¾èµ–
```kotlin
@Module
@InstallIn(SingletonComponent::class)
object ImageLoadingModule {
    // Coilé…ç½®
    - ImageLoader (é…ç½®ç¼“å­˜ã€è§£ç å™¨)
}
```

#### 9. ServiceModule - æœåŠ¡ä¾èµ–
```kotlin
@Module
@InstallIn(SingletonComponent::class)
object ServiceModule {
    - PendingOrdersStorage
}
```

### Hilt EntryPoints

ç”¨äºåœ¨éHiltç®¡ç†çš„ç±»ä¸­è·å–ä¾èµ–ï¼š

```kotlin
@EntryPoint
@InstallIn(SingletonComponent::class)
interface IdentificationEntryPoint {
    fun faceVerificationStatusManager(): FaceVerificationStatusManager
}

@EntryPoint
@InstallIn(SingletonComponent::class)
interface NursingExecutionEntryPoint {
    fun navigationHelper(): NavigationHelper
    fun toastHelper(): ToastHelper
}

// ... æ›´å¤šEntryPointæ¥å£
```

## ğŸ“± æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. ç”¨æˆ·è®¤è¯æ¨¡å—

#### ç™»å½•æµç¨‹
- **çŸ­ä¿¡éªŒè¯ç ç™»å½•**: æ‰‹æœºå· + éªŒè¯ç 
- **ä¼šè¯ç®¡ç†**: UserSessionRepository
- **çŠ¶æ€æŒä¹…åŒ–**: DataStore + Protocol Buffers

#### äººè„¸è¯†åˆ«è®¤è¯
- **è…¾è®¯äº‘äººè„¸æ´»ä½“æ£€æµ‹**: æœåŠ¡äººå‘˜è®¤è¯
- **ML Kitäººè„¸æ£€æµ‹**: æœ¬åœ°äººè„¸æ•è·
- **åŒé‡è®¤è¯**: æœåŠ¡äººå‘˜ + è€äººèº«ä»½éªŒè¯

```kotlin
/**
 * èº«ä»½è®¤è¯çŠ¶æ€
 */
enum class IdentificationState {
    INITIAL,           // åˆå§‹çŠ¶æ€
    SERVICE_VERIFIED,  // æœåŠ¡äººå‘˜å·²éªŒè¯
    ELDER_VERIFIED     // è€äººå·²éªŒè¯
}
```

### 2. è®¢å•ç®¡ç†æ¨¡å—

#### è®¢å•çŠ¶æ€æµè½¬
```
å¾…æ¥å• -> å·²æ¥å• -> æœåŠ¡ä¸­ -> å·²å®Œæˆ
```

#### æ ¸å¿ƒåŠŸèƒ½
- **ä»Šæ—¥è®¢å•åˆ—è¡¨**: æ˜¾ç¤ºå½“å¤©å¾…å¤„ç†è®¢å•
- **è¿›è¡Œä¸­è®¢å•**: å®æ—¶è®¢å•çŠ¶æ€è¿½è¸ª
- **è®¢å•è¯¦æƒ…**: å®Œæ•´çš„æœåŠ¡ä¿¡æ¯å±•ç¤º
- **æœåŠ¡é¡¹ç›®é€‰æ‹©**: å¤šé¡¹ç›®å‹¾é€‰ç®¡ç†
- **è®¢å•å®Œæˆ**: æœåŠ¡ç¡®è®¤ä¸è¯„ä»·

#### å…±äº«ViewModel
```kotlin
@HiltViewModel
class SharedOrderDetailViewModel @Inject constructor(
    private val sharedOrderRepository: SharedOrderRepository,
    private val orderRepository: OrderRepository,
    // ...
) : ViewModel() {
    // è®¢å•è¯¦æƒ…ç¼“å­˜
    // æ˜Ÿæ ‡è®¢å•åŠŸèƒ½
    // è®¢å•çŠ¶æ€ç®¡ç†
}
```

### 3. NFCç­¾åˆ°æ¨¡å—

#### NFCå·¥ä½œæµç¨‹
1. **NFCæ ‡ç­¾æ£€æµ‹**: MainActivityç›‘å¬NFC Intent
2. **æ ‡ç­¾æ•°æ®è§£æ**: æå–è®¢å•ä¿¡æ¯
3. **è‡ªåŠ¨å¯¼èˆª**: è·³è½¬åˆ°å¯¹åº”è®¢å•é¡µé¢
4. **ç­¾åˆ°ç¡®è®¤**: å¼€å§‹æœåŠ¡è®¡æ—¶

```kotlin
@Inject
lateinit var nfcManager: NfcManager

override fun onNewIntent(intent: Intent?) {
    super.onNewIntent(intent)
    intent?.let {
        if (it.action?.startsWith("android.nfc.action") == true) {
            nfcManager.handleNfcIntent(this, it)
        }
    }
}
```

### 4. ä½ç½®æœåŠ¡æ¨¡å—

#### å®šä½æä¾›è€…æ¶æ„
```kotlin
/**
 * ç»„åˆå®šä½æä¾›è€…
 * æ”¯æŒç³»ç»Ÿå®šä½å’Œé«˜å¾·å®šä½çš„åˆ‡æ¢
 */
class CompositeLocationProvider @Inject constructor(
    private val systemLocationProvider: SystemLocationProvider,
    private val amapLocationProvider: AmapLocationProvider
) {
    // æ™ºèƒ½é€‰æ‹©æœ€ä½³å®šä½æº
}
```

#### ä½ç½®è¿½è¸ªæœåŠ¡
- **å‰å°æœåŠ¡**: LocationTrackingService
- **å®šæ—¶ä¸ŠæŠ¥**: æ¯åˆ†é’Ÿä¸ŠæŠ¥ä½ç½®
- **æƒé™ç®¡ç†**: ç»Ÿä¸€æƒé™è¯·æ±‚

### 5. æœåŠ¡å€’è®¡æ—¶æ¨¡å—

#### å€’è®¡æ—¶æ¶æ„
```
ServiceCountdownViewModel
    â†“
CountdownForegroundService
    â†“
AlarmManager (ç²¾ç¡®é—¹é’Ÿ)
    â†“
CountdownAlarmReceiver
    â†“
AlarmRingtoneService (å“é“ƒ)
    â†“
CountdownAlarmActivity (å…¨å±æé†’)
```

#### å…³é”®ç‰¹æ€§
- **å‰å°æœåŠ¡**: ä¿è¯å€’è®¡æ—¶å¯é è¿è¡Œ
- **ç²¾ç¡®é—¹é’Ÿ**: ä½¿ç”¨`USE_EXACT_ALARM`æƒé™
- **é”å±æ˜¾ç¤º**: å…¨å±Intentæ˜¾ç¤ºæé†’
- **è‡ªåŠ¨å…³é—­**: 30ç§’åè‡ªåŠ¨å…³é—­æé†’

### 6. ç…§ç‰‡ä¸Šä¼ æ¨¡å—

#### æ‹ç…§åŠŸèƒ½
- **CameraXé›†æˆ**: ç°ä»£åŒ–ç›¸æœºAPI
- **æ°´å°åŠŸèƒ½**: æ—¶é—´ã€åœ°ç‚¹ã€è®¢å•ä¿¡æ¯
- **è‡ªåŠ¨æ—‹è½¬**: å¤„ç†è®¾å¤‡æ–¹å‘

#### ä¸Šä¼ æµç¨‹
```
æœ¬åœ°æ‹ç…§ -> æ·»åŠ æ°´å° -> å‹ç¼©å›¾ç‰‡ -> è…¾è®¯äº‘COSä¸Šä¼  -> æœåŠ¡å™¨ä¿å­˜URL
```

#### COSé…ç½®
```kotlin
/**
 * COSä¸Šä¼ å‚æ•°
 */
data class UploadParams(
    val file: File,
    val folder: String = CosConstants.FOLDER_IDENTIFICATION,
    val mimeType: String = "image/jpeg",
    val generateFileName: Boolean = true
)
```

### 7. äººè„¸æ•è·æ¨¡å—

#### æ‰‹åŠ¨äººè„¸æ•è·
```kotlin
@HiltViewModel
class ManualFaceCaptureViewModel @Inject constructor(
    @ApplicationContext private val context: Context
) : ViewModel() {
    
    /**
     * ä»å›¾ç‰‡ä¸­æ£€æµ‹äººè„¸
     */
    suspend fun detectFacesFromBitmap(bitmap: Bitmap): List<DetectedFace>
    
    /**
     * ä¿å­˜äººè„¸å›¾ç‰‡åˆ°æœ¬åœ°
     */
    suspend fun saveFaceImage(bitmap: Bitmap): Uri?
}
```

#### ML Kitäººè„¸æ£€æµ‹
- **é™æ€å›¾ç‰‡æ£€æµ‹**: ä»ç›¸å†Œé€‰æ‹©ç…§ç‰‡
- **å®æ—¶é¢„è§ˆ**: CameraXé›†æˆ
- **äººè„¸è´¨é‡è¯„ä¼°**: æ£€æµ‹äººè„¸è§’åº¦ã€å…‰ç…§

### 8. æ›´æ–°æ¨¡å—

#### ç‰ˆæœ¬æ£€æµ‹
```kotlin
interface SystemRepository {
    /**
     * ç‰ˆæœ¬æ£€æµ‹
     */
    suspend fun checkVersion(): ApiResult<AppVersionModel>
}
```

#### æ›´æ–°æµç¨‹
```
æ£€æŸ¥æ–°ç‰ˆæœ¬ -> æ˜¾ç¤ºæ›´æ–°å¯¹è¯æ¡† -> ä¸‹è½½APK (WorkManager) -> å®‰è£…æç¤º
```

## ğŸŒ ç½‘ç»œå±‚æ¶æ„

### APIæœåŠ¡æ¥å£

#### 1. ä¸»APIæœåŠ¡
```kotlin
interface LongCareApiService {
    // ç™»å½•ç›¸å…³
    @POST("login/loginPhone") suspend fun loginPhone(...)
    @POST("login/sendSmsCode") suspend fun sendSmsCode(...)
    
    // è®¢å•ç›¸å…³
    @POST("order/orderList") suspend fun getOrderList(...)
    @POST("order/orderInfo") suspend fun getOrderInfo(...)
    @POST("order/startOrder") suspend fun startOrder(...)
    @POST("order/endOrder") suspend fun endOrder(...)
    
    // äººè„¸ç›¸å…³
    @POST("face/setFace") suspend fun setFace(...)
    @POST("face/getFace") suspend fun getFace()
    
    // å®šä½ç›¸å…³
    @POST("position/addPosition") suspend fun addPosition(...)
    
    // ç³»ç»Ÿé…ç½®
    @POST("system/appConfig") suspend fun getSystemConfig()
    @POST("system/checkVersion") suspend fun checkVersion()
    
    // COSç›¸å…³
    @POST("cos/getToken") suspend fun getCosToken()
}
```

#### 2. è…¾è®¯äººè„¸APIæœåŠ¡
```kotlin
interface TencentFaceApiService {
    @GET("oauth2/accessToken") suspend fun getAccessToken(...)
    @GET("api/oauth2/api_ticket") suspend fun getApiTicket(...)
    @POST("api/server/getAdvFaceId") suspend fun getFaceId(...)
}
```

### ç½‘ç»œé…ç½®

#### OkHttpæ‹¦æˆªå™¨é“¾
```kotlin
OkHttpClient.Builder()
    .addInterceptor(MockInterceptor)        // Debugæ¨¡å¼Mockæ•°æ®
    .addInterceptor(LoggingInterceptor)     // æ—¥å¿—è®°å½•
    .connectTimeout(30, TimeUnit.SECONDS)
    .readTimeout(30, TimeUnit.SECONDS)
    .writeTimeout(30, TimeUnit.SECONDS)
    .build()
```

#### å®‰å…¨APIè°ƒç”¨å°è£…
```kotlin
/**
 * å®‰å…¨çš„APIè°ƒç”¨åŒ…è£…
 * ç»Ÿä¸€å¤„ç†å¼‚å¸¸ã€Tokenè¿‡æœŸã€ç½‘ç»œé”™è¯¯
 */
suspend fun <T> safeApiCall(
    dispatcher: CoroutineDispatcher,
    eventBus: AppEventBus,
    apiCall: suspend () -> BaseResponse<T>
): ApiResult<T> {
    return withContext(dispatcher) {
        try {
            val response = apiCall()
            when (response.resultCode) {
                1000 -> ApiResult.Success(response.data)
                401 -> {
                    eventBus.emit(AppEvent.Unauthorized)
                    ApiResult.Error("æœªæˆæƒ", 401)
                }
                else -> ApiResult.Error(response.resultMsg, response.resultCode)
            }
        } catch (e: Exception) {
            ApiResult.Error(e.message ?: "ç½‘ç»œé”™è¯¯", -1)
        }
    }
}
```

## ğŸ’¾ æ•°æ®æŒä¹…åŒ–

### 1. DataStore (Protocol Buffers)

#### åº”ç”¨çº§DataStore
```kotlin
@AppDataStore
DataStore<Preferences> - å…¨å±€åº”ç”¨é…ç½®
```

**å­˜å‚¨å†…å®¹**:
- ç”¨æˆ·ä¼šè¯ä¿¡æ¯ (User Proto)
- ç™»å½•Token
- ç³»ç»Ÿé…ç½®
- åº”ç”¨è®¾ç½®

#### ç”¨æˆ·çº§DataStore
```kotlin
/**
 * ç”¨æˆ·ç‰¹å®šæ•°æ®å­˜å‚¨ç®¡ç†å™¨
 * ä¸ºæ¯ä¸ªç”¨æˆ·ç»´æŠ¤ç‹¬ç«‹çš„DataStoreå®ä¾‹
 */
@Singleton
class UserSpecificDataStoreManager @Inject constructor(
    @ApplicationContext private val context: Context,
    @ApplicationScope private val coroutineScope: CoroutineScope,
    private val userSessionRepository: UserSessionRepository
) {
    // åŠ¨æ€åˆ›å»ºç”¨æˆ·DataStore
    fun getDataStoreForUser(userId: Int): DataStore<Preferences>
}
```

**ç”¨æˆ·æ•°æ®**:
- äººè„¸ç…§ç‰‡ç¼“å­˜è·¯å¾„
- å·²ä¸Šä¼ å›¾ç‰‡è®°å½•
- ç”¨æˆ·åå¥½è®¾ç½®

### 2. SharedPreferences

#### è®¢å•å­˜å‚¨
```kotlin
@OrderStorage
SharedPreferences - è®¢å•ç¼“å­˜
```

#### è®¾å¤‡IDå­˜å‚¨
```kotlin
@DeviceIdStorage
SharedPreferences - è®¾å¤‡å”¯ä¸€æ ‡è¯†
```

### 3. Roomæ•°æ®åº“ (æ½œåœ¨æ‰©å±•)

é¡¹ç›®å½“å‰æœªä½¿ç”¨Roomï¼Œä½†é…ç½®å·²å°±ç»ªï¼š
```kotlin
room {
    schemaDirectory("$projectDir/schemas")
}
```

**å¯æ‰©å±•åœºæ™¯**:
- æœ¬åœ°é€šçŸ¥å†å²è®°å½•
- ç¦»çº¿è®¢å•ç¼“å­˜
- ç”¨æˆ·æœåŠ¡è®°å½•æœ¬åœ°å­˜å‚¨

## ğŸ”” é€šçŸ¥ç³»ç»Ÿ

### é€šçŸ¥ç±»å‹

#### 1. å€’è®¡æ—¶é€šçŸ¥
```kotlin
/**
 * å€’è®¡æ—¶é€šçŸ¥ç®¡ç†å™¨
 */
class CountdownNotificationManager @Inject constructor(
    @ApplicationContext private val context: Context,
    private val notificationManager: NotificationManager
) {
    /**
     * åˆ›å»ºå€’è®¡æ—¶å‰å°é€šçŸ¥
     */
    fun createCountdownNotification(
        orderId: String,
        serviceName: String,
        remainingTime: Long
    ): Notification
    
    /**
     * æ›´æ–°å€’è®¡æ—¶é€šçŸ¥
     */
    fun updateCountdownNotification(...)
    
    /**
     * æ˜¾ç¤ºå€’è®¡æ—¶å®Œæˆé€šçŸ¥
     */
    fun showCountdownCompleteNotification(...)
}
```

#### 2. æœåŠ¡æé†’é€šçŸ¥
- **æœåŠ¡å¼€å§‹æé†’**: è®¢å•å¼€å§‹å‰é€šçŸ¥
- **æœåŠ¡ç»“æŸæé†’**: æœåŠ¡æ—¶é—´åˆ°æœŸæé†’

#### 3. ç³»ç»Ÿé€šçŸ¥
- **ç‰ˆæœ¬æ›´æ–°é€šçŸ¥**: æ–°ç‰ˆæœ¬å¯ç”¨æé†’
- **ä¸‹è½½å®Œæˆé€šçŸ¥**: APKä¸‹è½½å®Œæˆ

### é€šçŸ¥æ¸ é“é…ç½®
```kotlin
// å€’è®¡æ—¶é€šçŸ¥æ¸ é“
channelId = "countdown_channel"
importance = NotificationManager.IMPORTANCE_HIGH

// æœåŠ¡é€šçŸ¥æ¸ é“
channelId = "service_channel"
importance = NotificationManager.IMPORTANCE_DEFAULT
```

## ğŸ¨ UIè®¾è®¡è§„èŒƒ

### Material Design 3

#### ä¸»é¢˜é…ç½®
```kotlin
@Composable
fun LongCareTheme(
    darkTheme: Boolean = isSystemInDarkTheme(),
    dynamicColor: Boolean = true,
    content: @Composable () -> Unit
) {
    val colorScheme = when {
        dynamicColor && Build.VERSION.SDK_INT >= Build.VERSION_CODES.S -> {
            if (darkTheme) dynamicDarkColorScheme(context)
            else dynamicLightColorScheme(context)
        }
        darkTheme -> DarkColorScheme
        else -> LightColorScheme
    }
    
    MaterialTheme(
        colorScheme = colorScheme,
        typography = Typography,
        content = content
    )
}
```

#### é¢œè‰²ç³»ç»Ÿ
- **Primary**: ä¸»è‰²è°ƒ
- **Secondary**: è¾…åŠ©è‰²
- **Tertiary**: ç¬¬ä¸‰è‰²
- **Error**: é”™è¯¯è‰²
- **Background**: èƒŒæ™¯è‰²
- **Surface**: è¡¨é¢è‰²

### ç»„ä»¶åº“

#### é€šç”¨UIç»„ä»¶
- **UnifiedBackHandler**: ç»Ÿä¸€è¿”å›å¤„ç†
- **HomeBackHandler**: é¦–é¡µè¿”å›å¤„ç†
- **LockScreenOrientation**: é”å®šå±å¹•æ–¹å‘
- **ImageWithAdaptiveWidth**: è‡ªé€‚åº”å®½åº¦å›¾ç‰‡
- **LoadingDialog**: åŠ è½½å¯¹è¯æ¡†
- **ErrorDialog**: é”™è¯¯æç¤ºå¯¹è¯æ¡†

#### è‡ªå®šä¹‰ç»„ä»¶
- **OrderCard**: è®¢å•å¡ç‰‡
- **ServiceItemCard**: æœåŠ¡é¡¹ç›®å¡ç‰‡
- **UserInfoCard**: ç”¨æˆ·ä¿¡æ¯å¡ç‰‡
- **PhotoUploadCard**: ç…§ç‰‡ä¸Šä¼ å¡ç‰‡

### å±å¹•æ–¹å‘ç®¡ç†
```kotlin
/**
 * é”å®šå±å¹•æ–¹å‘
 * åœ¨ç‰¹å®šé¡µé¢å¼ºåˆ¶ç«–å±æˆ–æ¨ªå±æ˜¾ç¤º
 */
@Composable
fun LockScreenOrientation(orientation: Int) {
    val context = LocalContext.current
    DisposableEffect(orientation) {
        val activity = context.findActivity()
        val originalOrientation = activity?.requestedOrientation
        activity?.requestedOrientation = orientation
        
        onDispose {
            activity?.requestedOrientation = originalOrientation ?: 
                ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED
        }
    }
}
```

## ğŸ” å®‰å…¨æœºåˆ¶

### 1. ä»£ç æ··æ·†

#### ProGuardé…ç½®
```gradle
proguardFiles(
    getDefaultProguardFile("proguard-android-optimize.txt"),
    "proguard-rules.pro",
    "txkyc-face-consumer-proguard-rules.pro"
)
```

#### æ··æ·†è§„åˆ™
- **ä¿ç•™SDK**: è…¾è®¯äº‘SDKã€é«˜å¾·SDK
- **ä¿ç•™æ¨¡å‹ç±»**: APIè¯·æ±‚å“åº”æ¨¡å‹
- **ä¿ç•™Protocol Buffers**: Wireç”Ÿæˆç±»

### 2. åº”ç”¨ç­¾å

```kotlin
signingConfigs {
    create("release") {
        keyAlias = "longcare"
        keyPassword = "longcare^&*()"
        storeFile = file("../keystore.jks")
        storePassword = "longcare~!@#$%"
        enableV1Signing = true
        enableV2Signing = true
        enableV3Signing = true
        enableV4Signing = true
    }
}
```

### 3. ç½‘ç»œå®‰å…¨

#### HTTPSå¼ºåˆ¶
- æ‰€æœ‰APIè¯·æ±‚ä½¿ç”¨HTTPS
- Certificate Pinning (å¯é€‰)

#### Tokenç®¡ç†
```kotlin
/**
 * Tokenè‡ªåŠ¨åˆ·æ–°
 * - å­˜å‚¨åœ¨DataStore
 * - 401è‡ªåŠ¨é‡æ–°ç™»å½•
 * - å¹¶å‘è¯·æ±‚å»é‡
 */
```

### 4. æ•æ„Ÿæ•°æ®åŠ å¯†

#### RSAå…¬é’¥
```kotlin
buildConfigField(
    "String",
    "PUBLIC_KEY",
    "\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...\""
)
```

#### ç¬¬ä¸‰æ–¹å¯†é’¥è§£å¯†
```kotlin
/**
 * SystemConfig.thirdKeyStrè‡ªåŠ¨è§£å¯†
 * - AESè§£å¯†
 * - JSONè§£æ
 * - å¯†é’¥ç¼“å­˜
 */
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. Baseline Profile

```kotlin
plugins {
    alias(libs.plugins.baselineprofile)
}

dependencies {
    "baselineProfile"(project(":baselineprofile"))
    implementation(libs.androidx.profileinstaller)
}
```

**ä¼˜åŒ–æ•ˆæœ**:
- å¯åŠ¨é€Ÿåº¦æå‡30%
- UIæ¸²æŸ“ä¼˜åŒ–
- å…³é”®è·¯å¾„é¢„ç¼–è¯‘

### 2. å›¾ç‰‡åŠ è½½ä¼˜åŒ–

#### Coilé…ç½®
```kotlin
ImageLoader.Builder(context)
    .memoryCache {
        MemoryCache.Builder(context)
            .maxSizePercent(0.25)  // 25% RAM
            .build()
    }
    .diskCache {
        DiskCache.Builder()
            .directory(context.cacheDir.resolve("image_cache"))
            .maxSizeBytes(50 * 1024 * 1024)  // 50MB
            .build()
    }
    .components {
        add(SvgDecoder.Factory())
        add(GifDecoder.Factory())
        add(VideoFrameDecoder.Factory())
    }
    .crossfade(true)
    .build()
```

### 3. ç½‘ç»œä¼˜åŒ–

- **è¿æ¥æ± **: OkHttpè¿æ¥å¤ç”¨
- **å‹ç¼©**: GZIPè‡ªåŠ¨å‹ç¼©
- **ç¼“å­˜**: HTTPç¼“å­˜ç­–ç•¥
- **è¶…æ—¶**: åˆç†çš„è¶…æ—¶é…ç½®

### 4. å†…å­˜ä¼˜åŒ–

- **Lifecycleæ„ŸçŸ¥**: è‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ
- **StateFlow**: å†·æµï¼ŒæŒ‰éœ€è®¢é˜…
- **LazyColumn**: åˆ—è¡¨è™šæ‹ŸåŒ–
- **Bitmapå¤ç”¨**: é¿å…å†…å­˜æ³„æ¼

### 5. ç¼–è¯‘ä¼˜åŒ–

#### å¤šæ¨¡å—æ¶æ„ (æ½œåœ¨)
```
å½“å‰: å•æ¨¡å—åº”ç”¨
ä¼˜åŒ–: app + feature-modules + core
```

#### KSPæ›¿ä»£KAPT
```kotlin
plugins {
    alias(libs.plugins.ksp)  // ç¼–è¯‘é€Ÿåº¦æå‡2-3å€
}
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

```kotlin
testImplementation(libs.junit)
testImplementation(libs.mockk)
testImplementation(libs.robolectric)
testImplementation(libs.androidx.test.core)
testImplementation(libs.androidx.work.testing)
```

**æµ‹è¯•è¦†ç›–**:
- Repositoryå±‚æµ‹è¯•
- ViewModelå±‚æµ‹è¯•
- å·¥å…·ç±»æµ‹è¯•

### UIæµ‹è¯•

```kotlin
androidTestImplementation(libs.androidx.test.ext.junit)
androidTestImplementation(libs.androidx.test.espresso.core)
androidTestImplementation(libs.androidx.compose.ui.test.junit4)
```

**æµ‹è¯•åœºæ™¯**:
- ç™»å½•æµç¨‹
- è®¢å•æ“ä½œ
- å¯¼èˆªè·³è½¬

### æ€§èƒ½æµ‹è¯•

```kotlin
androidTestImplementation(libs.androidx.benchmark.macro.junit4)
```

## ğŸ“ å¼€å‘è§„èŒƒ

### ä»£ç æ³¨é‡Šè§„èŒƒ

#### ç±»æ³¨é‡Š
```kotlin
/**
 * ç”¨æˆ·ç™»å½•Repository
 * 
 * è´Ÿè´£å¤„ç†ç”¨æˆ·ç™»å½•ç›¸å…³çš„æ•°æ®æ“ä½œï¼ŒåŒ…æ‹¬ï¼š
 * - æ‰‹æœºå·éªŒè¯ç ç™»å½•
 * - ç™»å½•çŠ¶æ€æŒä¹…åŒ–
 * - ç”¨æˆ·ä¿¡æ¯ç¼“å­˜
 * 
 * @property apiService APIæœåŠ¡æ¥å£
 * @property dataStore æ•°æ®å­˜å‚¨
 */
class LoginRepositoryImpl @Inject constructor(
    private val apiService: LongCareApiService,
    private val dataStore: AppDataStore
) : LoginRepository
```

#### æ–¹æ³•æ³¨é‡Š
```kotlin
/**
 * å‘é€çŸ­ä¿¡éªŒè¯ç 
 * 
 * @param phone æ‰‹æœºå·ç ï¼Œæ ¼å¼ï¼š11ä½æ•°å­—
 * @return ApiResult<Unit> å‘é€ç»“æœ
 * @throws NetworkException ç½‘ç»œå¼‚å¸¸
 */
override suspend fun sendSmsCode(phone: String): ApiResult<Unit>
```

#### å‚æ•°æ³¨é‡Š
```kotlin
/**
 * ä¸Šä¼ æ–‡ä»¶åˆ°COS
 * 
 * @param file è¦ä¸Šä¼ çš„æ–‡ä»¶
 * @param folder COSç›®å½•ï¼Œå¦‚ "identification"ã€"service"
 * @param mimeType MIMEç±»å‹ï¼Œå¦‚ "image/jpeg"
 * @param generateFileName æ˜¯å¦è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶åï¼Œé»˜è®¤true
 * @return CosUploadResult ä¸Šä¼ ç»“æœï¼ŒåŒ…å«æ–‡ä»¶URL
 */
suspend fun uploadFile(
    file: File,
    folder: String,
    mimeType: String = "image/jpeg",
    generateFileName: Boolean = true
): CosUploadResult
```

### å‘½åè§„èŒƒ

#### åŒ…å‘½å
- å…¨å°å†™
- å±‚æ¬¡æ¸…æ™°: `com.ytone.longcare.features.login.ui`

#### ç±»å‘½å
- **PascalCase**: `LoginViewModel`
- **åç¼€**: 
  - `Screen`: UIé¡µé¢ (`LoginScreen`)
  - `ViewModel`: è§†å›¾æ¨¡å‹ (`LoginViewModel`)
  - `Repository`: ä»“åº“ (`LoginRepository`)
  - `Impl`: å®ç°ç±» (`LoginRepositoryImpl`)
  - `Manager`: ç®¡ç†å™¨ (`NfcManager`)
  - `Helper`: å¸®åŠ©ç±» (`ToastHelper`)
  - `Utils`: å·¥å…·ç±» (`TimeUtils`)

#### æ–¹æ³•å‘½å
- **camelCase**: `sendSmsCode()`
- **åŠ¨è¯å¼€å¤´**: `get`, `set`, `create`, `update`, `delete`
- **å¸ƒå°”æ–¹æ³•**: `is`, `has`, `should`, `can`

#### å˜é‡å‘½å
- **camelCase**: `userId`, `orderList`
- **å¸¸é‡**: `UPPER_SNAKE_CASE` (`MAX_RETRY_COUNT`)
- **ç§æœ‰å­—æ®µ**: `_uiState` (StateFlow backing field)

### åç¨‹ä½¿ç”¨è§„èŒƒ

```kotlin
@HiltViewModel
class MyViewModel @Inject constructor(
    private val repository: MyRepository,
    @IoDispatcher private val ioDispatcher: CoroutineDispatcher
) : ViewModel() {
    
    // ä½¿ç”¨viewModelScope
    fun loadData() {
        viewModelScope.launch {
            // UIæ“ä½œåœ¨Mainçº¿ç¨‹
            _uiState.value = UiState.Loading
            
            // IOæ“ä½œåœ¨IOçº¿ç¨‹
            val result = withContext(ioDispatcher) {
                repository.getData()
            }
            
            // å›åˆ°Mainçº¿ç¨‹æ›´æ–°UI
            _uiState.value = when (result) {
                is ApiResult.Success -> UiState.Success(result.data)
                is ApiResult.Error -> UiState.Error(result.message)
            }
        }
    }
}
```

### ViewModelè§„èŒƒ

```kotlin
/**
 * ViewModelæ ‡å‡†æ¨¡æ¿
 */
@HiltViewModel
class MyViewModel @Inject constructor(
    private val repository: MyRepository,
    private val savedStateHandle: SavedStateHandle
) : ViewModel() {
    
    // å†…éƒ¨å¯å˜çŠ¶æ€
    private val _uiState = MutableStateFlow<UiState>(UiState.Initial)
    
    // å¯¹å¤–æš´éœ²ä¸å¯å˜çŠ¶æ€
    val uiState: StateFlow<UiState> = _uiState.asStateFlow()
    
    // å•æ¬¡äº‹ä»¶
    private val _events = MutableSharedFlow<Event>()
    val events: SharedFlow<Event> = _events.asSharedFlow()
    
    // UIäº‹ä»¶å¤„ç†
    fun onEvent(event: UiEvent) {
        when (event) {
            is UiEvent.LoadData -> loadData()
            is UiEvent.Refresh -> refresh()
        }
    }
}
```

## ğŸ”¨ æ„å»ºé…ç½®

### Gradleç‰ˆæœ¬
- **Gradle Wrapper**: 8.11.1
- **Android Gradle Plugin**: 8.13.1
- **Kotlin**: 2.2.21

### ç¼–è¯‘é…ç½®
```kotlin
android {
    compileSdk = 36
    
    defaultConfig {
        minSdk = 24
        targetSdk = 34
        
        ndk {
            abiFilters += listOf("arm64-v8a")  // ä»…æ”¯æŒ64ä½æ¶æ„
        }
    }
    
    kotlin {
        jvmToolchain(21)  // Java 21
    }
    
    buildFeatures {
        buildConfig = true
        compose = true
        viewBinding = true
    }
}
```

### æ„å»ºå˜ä½“

#### Debugæ„å»º
- **Mockæ•°æ®**: æ”¯æŒæ¨¡æ‹ŸAPIå“åº”
- **æ—¥å¿—**: è¯¦ç»†æ—¥å¿—è¾“å‡º
- **è°ƒè¯•å·¥å…·**: LeakCanaryã€Flipper (å¯é€‰)

#### Releaseæ„å»º
- **æ··æ·†**: ä»£ç æ··æ·†å’Œä¼˜åŒ–
- **èµ„æºå‹ç¼©**: shrinkResources
- **ç­¾å**: Releaseç­¾åé…ç½®
- **ç”Ÿäº§API**: æ­£å¼ç¯å¢ƒURL

### APKå‘½åè§„åˆ™
```
app-v{versionName}-{date}-{versionCode}-{buildType}.apk

ç¤ºä¾‹: app-v1.0-251129-13-release.apk
```

## ğŸ“Š ç›‘æ§ä¸æ—¥å¿—

### å´©æºƒæ—¥å¿—ç®¡ç†

```kotlin
/**
 * å…¨å±€å´©æºƒæ—¥å¿—ç®¡ç†å™¨
 */
@Singleton
class CrashLogManager @Inject constructor(
    @ApplicationContext private val context: Context
) {
    /**
     * è®°å½•å´©æºƒä¿¡æ¯åˆ°æœ¬åœ°æ–‡ä»¶
     */
    fun logCrash(throwable: Throwable)
    
    /**
     * è·å–å´©æºƒæ—¥å¿—æ–‡ä»¶
     */
    fun getCrashLogs(): List<File>
}
```

### æ—¥å¿—å·¥å…·

```kotlin
/**
 * æ—¥å¿—æ‰©å±•å‡½æ•°
 */
fun Any.logD(tag: String, message: String) {
    if (BuildConfig.DEBUG) {
        Log.d(tag, message)
    }
}

fun Any.logE(tag: String, message: String, throwable: Throwable? = null) {
    Log.e(tag, message, throwable)
}
```

### äº‹ä»¶è¿½è¸ª

```kotlin
/**
 * åº”ç”¨äº‹ä»¶æ€»çº¿
 * ç”¨äºè·¨ç»„ä»¶é€šä¿¡å’Œäº‹ä»¶è¿½è¸ª
 */
@Singleton
class AppEventBus @Inject constructor(
    @ApplicationScope private val scope: CoroutineScope
) {
    sealed class AppEvent {
        object Unauthorized : AppEvent()          // æœªæˆæƒ
        object NetworkError : AppEvent()          // ç½‘ç»œé”™è¯¯
        data class OrderUpdated(val orderId: String) : AppEvent()
        data class NfcTagDetected(val tagData: String) : AppEvent()
    }
    
    private val _events = MutableSharedFlow<AppEvent>()
    val events: SharedFlow<AppEvent> = _events.asSharedFlow()
    
    suspend fun emit(event: AppEvent) {
        _events.emit(event)
    }
}
```

## ğŸ”„ æŒç»­é›†æˆ/éƒ¨ç½² (å»ºè®®)

### CI/CDæµç¨‹ (å¯é€‰)

```yaml
# .github/workflows/android.yml
name: Android CI

on:
  push:
    branches: [ master, develop ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up JDK 21
      uses: actions/setup-java@v3
      with:
        java-version: '21'
        distribution: 'temurin'
        cache: gradle
        
    - name: Grant execute permission for gradlew
      run: chmod +x gradlew
      
    - name: Build with Gradle
      run: ./gradlew assembleDebug
      
    - name: Run tests
      run: ./gradlew test
      
    - name: Upload APK
      uses: actions/upload-artifact@v3
      with:
        name: app-debug
        path: app/build/outputs/apk/debug/*.apk
```

## ğŸ“š ç¬¬ä¸‰æ–¹SDKé›†æˆ

### 1. è…¾è®¯äº‘äººè„¸è¯†åˆ«SDK

**ç‰ˆæœ¬**: v6.6.2

**åŠŸèƒ½**:
- æ´»ä½“æ£€æµ‹
- äººè„¸æ¯”å¯¹
- èº«ä»½è¯OCR

**é›†æˆ**:
```kotlin
implementation(files("libs/WbCloudFaceLiveSdk-face-v6.6.2-8e4718fc.aar"))
implementation(files("libs/WbCloudNormal-v5.1.10-4e3e198.aar"))
```

### 2. é«˜å¾·åœ°å›¾å®šä½SDK

**ç‰ˆæœ¬**: 6.5.1

**åŠŸèƒ½**:
- ç²¾å‡†å®šä½
- åœ°ç†å›´æ 
- ä½ç½®ä¿¡æ¯

**é›†æˆ**:
```kotlin
implementation(libs.amap.location)
```

**é…ç½®**:
```xml
<!-- AndroidManifest.xml -->
<service android:name="com.amap.api.location.APSService" />
```

### 3. è…¾è®¯äº‘COS SDK

**ç‰ˆæœ¬**: 5.9.47

**åŠŸèƒ½**:
- å¯¹è±¡å­˜å‚¨
- æ–‡ä»¶ä¸Šä¼ ä¸‹è½½
- CDNåŠ é€Ÿ

**é›†æˆ**:
```kotlin
implementation(libs.tencent.cos.android)
```

### 4. Google ML Kit

**ç‰ˆæœ¬**: 16.1.7

**åŠŸèƒ½**:
- æœ¬åœ°äººè„¸æ£€æµ‹
- æ— éœ€ç½‘ç»œ
- å®æ—¶æ£€æµ‹

**é›†æˆ**:
```kotlin
implementation(libs.face.detection)
```

## ğŸ¯ æœªæ¥è§„åˆ’

### çŸ­æœŸä¼˜åŒ– (1-3ä¸ªæœˆ)

1. **æµ‹è¯•è¦†ç›–ç‡æå‡**
   - å•å…ƒæµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°60%
   - UIæµ‹è¯•å…³é”®æµç¨‹å…¨è¦†ç›–

2. **æ€§èƒ½ç›‘æ§**
   - é›†æˆFirebase Performance
   - ç›‘æ§ANRå’ŒCrash

3. **ä»£ç è´¨é‡**
   - å¼•å…¥SonarQube
   - ç»Ÿä¸€ä»£ç é£æ ¼ (ktlint)

### ä¸­æœŸè§„åˆ’ (3-6ä¸ªæœˆ)

1. **æ¨¡å—åŒ–é‡æ„**
   - æ‹†åˆ†featureæ¨¡å—
   - å…±äº«coreæ¨¡å—

2. **ç¦»çº¿æ”¯æŒ**
   - Roomæ•°æ®åº“å®Œå–„
   - ç¦»çº¿è®¢å•å¤„ç†

3. **å¤šè¯­è¨€æ”¯æŒ**
   - å›½é™…åŒ–èµ„æº
   - åŠ¨æ€è¯­è¨€åˆ‡æ¢

### é•¿æœŸæ„¿æ™¯ (6-12ä¸ªæœˆ)

1. **æ¶æ„å‡çº§**
   - Kotlin Multiplatform
   - iOSç‰ˆæœ¬å…±äº«ä¸šåŠ¡é€»è¾‘

2. **åŠŸèƒ½å¢å¼º**
   - AIæ™ºèƒ½æ¨è
   - è¯­éŸ³åŠ©æ‰‹
   - æ•°æ®åˆ†æçœ‹æ¿

3. **æŠ€æœ¯å€ºåŠ¡æ¸…ç†**
   - ç§»é™¤åºŸå¼ƒä»£ç 
   - ç»Ÿä¸€è®¾è®¡ç³»ç»Ÿ
   - é‡æ„é—ç•™æ¨¡å—

## ğŸ“– å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£
- [Android Developer Guide](https://developer.android.com)
- [Jetpack Compose](https://developer.android.com/jetpack/compose)
- [Kotlin Coroutines](https://kotlinlang.org/docs/coroutines-overview.html)
- [Dagger Hilt](https://dagger.dev/hilt/)

### æŠ€æœ¯åšå®¢
- [Android Weekly](https://androidweekly.net/)
- [Kotlin Blog](https://blog.jetbrains.com/kotlin/)

### æœ€ä½³å®è·µ
- [Android Architecture Patterns](https://developer.android.com/topic/architecture)
- [Guide to app architecture](https://developer.android.com/topic/architecture)

## ğŸ‘¥ å¼€å‘å›¢é˜Ÿ

### è”ç³»æ–¹å¼
- **é¡¹ç›®ä»“åº“**: yyg20101/longcare
- **åˆ†æ”¯**: master_face2

### æŠ€æœ¯æ”¯æŒ
å¦‚æœ‰æŠ€æœ¯é—®é¢˜ï¼Œè¯·æäº¤Issueæˆ–è”ç³»é¡¹ç›®è´Ÿè´£äººã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025å¹´11æœˆ29æ—¥  
**ç»´æŠ¤è€…**: é•¿æŠ¤é™©å¼€å‘å›¢é˜Ÿ
