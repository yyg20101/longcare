# 服务倒计时功能测试清单

## 编译修复验证 ✅

### 修复内容
1. ✅ 添加 `OrderInfoM` 导入语句
2. ✅ 修复 `calculateServiceInfo()` 函数的参数类型声明
3. ✅ 所有编译错误已解决

---

## 快速验证测试（5分钟）

### 1. 基本功能测试
- [ ] 启动应用，进入服务倒计时页面
- [ ] 检查倒计时是否正常显示
- [ ] 检查倒计时是否正常递减

**预期结果**：倒计时正常显示并每秒递减

---

### 2. 锁屏解锁测试（重点）
**步骤**：
1. 启动倒计时
2. 记录当前时间（例如：12:30:00）
3. 锁屏
4. 等待10秒
5. 解锁

**预期结果**：
- ✅ 倒计时时间应该是 12:29:50（准确减少10秒）
- ❌ 不应该重置为初始时间
- ❌ 不应该出现时间跳跃

---

### 3. 后台切换测试（重点）
**步骤**：
1. 启动倒计时
2. 记录当前时间（例如：12:30:00）
3. 按Home键切换到桌面
4. 等待10秒
5. 重新打开应用

**预期结果**：
- ✅ 倒计时时间应该是 12:29:50（准确减少10秒）
- ❌ 不应该重新初始化
- ❌ 不应该出现时间跳跃

---

## 完整功能测试（15分钟）

### 4. 超时测试
**步骤**：
1. 选择一个1分钟的服务项目
2. 启动倒计时
3. 等待倒计时结束（00:00:00）
4. 观察超时计时

**预期结果**：
- ✅ 倒计时结束后自动进入超时状态
- ✅ 超时时间从 00:00:01 开始递增
- ✅ 状态显示为"服务超时"
- ✅ 按钮变为蓝色"结束服务"

---

### 5. 权限测试
**步骤**：
1. 卸载应用重新安装
2. 启动倒计时
3. 拒绝通知权限
4. 观察提示

**预期结果**：
- ✅ 显示权限提示对话框
- ✅ 倒计时仍然正常运行
- ✅ 可以点击"去设置"跳转到设置页面

---

### 6. 提前结束测试
**步骤**：
1. 启动倒计时
2. 上传护理前和护理后照片
3. 点击"提前结束服务"按钮
4. 确认提前结束

**预期结果**：
- ✅ 显示二次确认对话框
- ✅ 确认后跳转到NFC签到页面
- ✅ 前台服务停止
- ✅ 定位服务停止
- ✅ 闹钟取消

---

### 7. 正常结束测试
**步骤**：
1. 启动倒计时
2. 等待倒计时结束
3. 上传护理前和护理后照片
4. 点击"结束服务"按钮

**预期结果**：
- ✅ 直接跳转到NFC签到页面（无需二次确认）
- ✅ 所有资源正常清理

---

### 8. 照片验证测试
**步骤**：
1. 启动倒计时
2. 不上传照片
3. 点击"结束服务"按钮

**预期结果**：
- ✅ 显示Toast提示"请上传照片"
- ❌ 不应该跳转到下一页

---

### 9. 页面退出测试
**步骤**：
1. 启动倒计时
2. 点击返回按钮退出页面
3. 观察通知栏

**预期结果**：
- ✅ 前台服务通知仍然显示
- ✅ 定位服务继续运行
- ✅ 闹钟已取消
- ✅ 响铃服务已停止（如果正在响铃）

---

### 10. 服务恢复测试
**步骤**：
1. 启动倒计时
2. 记录当前时间
3. 杀掉应用进程
4. 重新打开应用
5. 进入倒计时页面

**预期结果**：
- ✅ 倒计时时间准确恢复
- ✅ 前台服务继续运行
- ✅ 定位服务继续运行

---

## 压力测试（可选）

### 11. 长时间运行测试
**步骤**：
1. 选择一个2小时的服务项目
2. 启动倒计时
3. 期间多次锁屏解锁、切换应用
4. 观察时间准确性

**预期结果**：
- ✅ 时间始终准确
- ❌ 不出现时间跳跃或累积误差

---

### 12. 多次初始化测试
**步骤**：
1. 启动倒计时
2. 返回上一页
3. 重新进入倒计时页面
4. 重复5次

**预期结果**：
- ✅ 每次都能正确恢复倒计时状态
- ❌ 不出现重复初始化
- ❌ 不出现内存泄漏

---

## 已知问题检查

### ✅ 已修复的问题
- [x] 锁屏解锁后倒计时重置
- [x] 后台切换后倒计时跳跃
- [x] 超时计时不准确
- [x] 生命周期恢复时重复初始化
- [x] 资源清理不完整

### ⚠️ 需要注意的边界情况
- [ ] 系统时间修改（用户手动修改时间）
- [ ] 时区切换
- [ ] 设备重启
- [ ] 低电量模式
- [ ] 省电模式

---

## 测试结果记录

### 测试环境
- **设备型号**：_____________
- **Android版本**：_____________
- **应用版本**：_____________
- **测试日期**：_____________
- **测试人员**：_____________

### 测试结果
| 测试项 | 结果 | 备注 |
|--------|------|------|
| 1. 基本功能 | ⬜ 通过 ⬜ 失败 | |
| 2. 锁屏解锁 | ⬜ 通过 ⬜ 失败 | |
| 3. 后台切换 | ⬜ 通过 ⬜ 失败 | |
| 4. 超时测试 | ⬜ 通过 ⬜ 失败 | |
| 5. 权限测试 | ⬜ 通过 ⬜ 失败 | |
| 6. 提前结束 | ⬜ 通过 ⬜ 失败 | |
| 7. 正常结束 | ⬜ 通过 ⬜ 失败 | |
| 8. 照片验证 | ⬜ 通过 ⬜ 失败 | |
| 9. 页面退出 | ⬜ 通过 ⬜ 失败 | |
| 10. 服务恢复 | ⬜ 通过 ⬜ 失败 | |

### 发现的问题
1. _____________________________________________
2. _____________________________________________
3. _____________________________________________

---

## 性能指标

### 时间准确性
- **测试方法**：启动倒计时，等待5分钟，对比实际时间
- **允许误差**：±2秒
- **实际误差**：_____________

### 内存使用
- **初始内存**：_____________
- **运行5分钟后**：_____________
- **运行30分钟后**：_____________

### 电量消耗
- **测试时长**：30分钟
- **电量消耗**：_____________%

---

## 回归测试清单

在每次修改后，至少执行以下测试：
- [ ] 基本功能测试（测试1）
- [ ] 锁屏解锁测试（测试2）
- [ ] 后台切换测试（测试3）
- [ ] 超时测试（测试4）

---

**测试完成后请更新此文档并提交测试报告！** 📝
